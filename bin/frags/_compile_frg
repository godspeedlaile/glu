

#
# Body of the glucompile script
#

COMPILE_OPTIONS=-nowarn

#
# Prints help text
#
function glucompile_help
{
    echo -e "
Welcome to Glu. (c) 2010 MuleSoft.
Version: $VERSION
"
    end_in_error=0
    if [ -n "$1" ]; then
        echo -e "Error: Illegal option: $1\n"
        end_in_error=1
    else
        echo -e "This is the '$COMPILE_SCRIPT_NAME' script, with which you can compile the
Java sources (or Java components) of a Glu server.
"
    fi
    echo -e "Usage: $COMPILE_SCRIPT_NAME [all|components]\n"
    return $end_in_error
}

#
# Compiles all Java sources under a given
# path ($1), except the path that's specified
# in $2.
#
function glucompile_source
{
    if [ -z $1 ]; then
        comp_path="."
    else
        comp_path="$1"
    fi
    cd $GLU_HOME/src/java
    if [ -z $2 ]; then
        # No exclusions
        javac $COMPILE_OPTIONS `find $1 -name '*.java'`
        return $?
    else
        # Some path was excluded
        javac $COMPILE_OPTIONS `find $1 \( -path $2 \) -prune -o -name '*.java'`
        return $?
    fi
}

#
# Compiling the entire system
#
function compile_all
{
    echo -e "\nPreparing to compile Glu Java sources (including all Java components)."
    echo "Please wait..."
    glucompile_source org/mulesource/glu/
    if [ $? == 0 ]; then
        echo -e "Compilation was successful.\n"
        exit 0
    else
        echo -e "Error: Compilation failed. Abort.\n"
        exit 1
    fi
}


#
# Compiling only the components
#
function compile_components
{
    echo -e "\nPreparing to compile Glu Java components only."
    echo "Please wait..."
    glucompile_source org/mulesource/glu/ org/mulesource/glu/component/api/
    if [ $? == 0 ]; then
        echo "Compilation was successful."
        return 0
    else
        echo "Error: Compilation failed. Abort."
        exit 1
    fi
}



case $1 in
    all)         compile_all;;
    components)  compile_components;;
    help)        glucompile_help;;
    *)           glucompile_help $1;;
esac



